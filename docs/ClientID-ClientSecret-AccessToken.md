Client ID, Client Secret, and Access Token
1. Client ID vs Client Secret

Client ID ‚Üí Public identifier for the app.
Example: my-mobile-app

Safe if leaked ‚Äî it only tells which app is calling.

Client Secret ‚Üí Password generated by the IAM when the app registers.
Example: Xyz123$SuperSecret

Used only by confidential clients (e.g., backend apps).

Never embedded in mobile apps or SPAs (public clients).

üëâ Client registers with IAM ‚Üí IAM stores client_id and client_secret.
üëâ Client uses them only when exchanging for tokens (not on every request).

2. When does the client send the secret?
   a) Client Registration (one-time setup)

Client is registered in IAM.

IAM generates:

client_id (stored in DB)

client_secret (given once to client, stored hashed in DB like a password)

b) Token Request (ongoing)

When the client asks for an access token (/token endpoint), it proves its identity with client_id + client_secret.

Example:

POST /token
Authorization: Basic base64(client_id:client_secret)
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&code=abc123&redirect_uri=https://myapp/callback


Best practice: Authorization header.

Less secure alternative: Sending client_id + client_secret in body.

3. Who authenticates who?

IAM authenticates clients ‚Üí using client_id + client_secret (or mTLS, JWT assertion).

IAM authenticates users ‚Üí using username/password, biometrics, social login, etc.

üëâ Both happen only at the Authorization Server (IAM).

4. Who gives tokens?

Only the /token endpoint issues tokens:

Access Token ‚Üí short-lived (5‚Äì15 minutes), used for API calls.

Refresh Token ‚Üí long-lived, used to request new access tokens.

Not during login.
Not during checkAccess.
Not during registration.
‚úÖ Only at /token.

Flow:

Client redirects user to IAM (/authorize).

IAM authenticates user.

IAM returns authorization code to client.

Client calls /token with client_id + client_secret + code.

IAM issues access token + refresh token.

5. Resource Access Flow

Client registers ‚Üí gets client_id + client_secret.

User logs in ‚Üí IAM issues access + refresh token.

Client calls APIs with:

Authorization: Bearer <access_token>


Resource server (API Gateway / checkAccess):

Validates token.

Reads sub (user) + client_id (app).

Applies policies.

Returns allowed / denied.

6. Clearing up Confusion

User authentication = IAM‚Äôs job ‚Üí but tokens are only given at /token.

Client authentication = secret is used only at /token, not every API call.

Client registration = usually manual (admin creates clients). Not the same as login.

‚úÖ Key takeaway:

client_id = public app identifier.

client_secret = private app password (confidential clients only).

access_token = proof of authz/authn, used on every API call.

refresh_token = used only at /token to get new access tokens.

/token = only place tokens are created or rotated.

7. How client_id is assigned

IAM generates it (not client).

Must be unique and unguessable.

Example:

{
"client_id": "c1c839f0-9aa2-4a21-9e42-98a6f9ffac3b",
"client_secret": "jDk8sh2...."
}

8. Client Registration
   What IAM stores in DB
   Field	Purpose
   id (internal PK)	DB primary key
   client_id	Public identifier (unique, IAM-generated)
   client_secret_hash	Hashed secret (for confidential clients)
   name	Human-friendly name (‚ÄúMobile App‚Äù)
   type	public (SPA, mobile) or confidential (server)
   redirect_uris	Allowed callback URLs
   grant_types	Allowed OAuth2 flows
   scopes	Allowed scopes
   audience	Allowed resource servers
   created_at / updated_at	Audit fields
   status	Active / disabled

Optional:

jwks_uri

allowed_cors_origins

token_endpoint_auth_method

Example: Dynamic Client Registration

Request:

{
"client_name": "My Mobile App",
"redirect_uris": ["https://myapp.com/callback"],
"grant_types": ["authorization_code", "refresh_token"],
"response_types": ["code"],
"scope": "openid profile read:invoices",
"token_endpoint_auth_method": "client_secret_basic"
}


IAM response:

{
"client_id": "c1c839f0-9aa2-4a21-9e42-98a6f9ffac3b",
"client_secret": "Xyz123$SuperSecret",
"client_name": "My Mobile App",
"redirect_uris": ["https://myapp.com/callback"],
"grant_types": ["authorization_code", "refresh_token"],
"scope": "openid profile read:invoices"
}

Admin-controlled registration (simpler)

Admins create clients in IAM dashboard.

IAM provides client_id + client_secret out-of-band (copy once).

‚úÖ Most production systems do this (Keycloak/Okta).

Dynamic registration is optional, often disabled for security.

‚úÖ TL;DR

DB stores ‚Üí client_id, client_secret_hash, type, URIs, grants, scopes.

Client provides ‚Üí name, redirect URIs, grant types, scopes.

IAM generates ‚Üí client_id and client_secret.